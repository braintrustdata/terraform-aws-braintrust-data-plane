## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_additional_kms_key_policies"></a> [additional\_kms\_key\_policies](#input\_additional\_kms\_key\_policies) | Additional IAM policy statements to append to the generated KMS key. | `list(any)` | `[]` | no |
| <a name="input_ai_proxy_reserved_concurrent_executions"></a> [ai\_proxy\_reserved\_concurrent\_executions](#input\_ai\_proxy\_reserved\_concurrent\_executions) | The number of concurrent executions to reserve for the AI Proxy. Setting this will prevent the AI Proxy from throttling other lambdas in your account. Note this will take away from your global concurrency limit in your AWS account. | `number` | `-1` | no |
| <a name="input_api_handler_provisioned_concurrency"></a> [api\_handler\_provisioned\_concurrency](#input\_api\_handler\_provisioned\_concurrency) | The number API Handler instances to provision and keep alive. This reduces cold start times and improves latency, with some increase in cost. | `number` | `1` | no |
| <a name="input_api_handler_reserved_concurrent_executions"></a> [api\_handler\_reserved\_concurrent\_executions](#input\_api\_handler\_reserved\_concurrent\_executions) | The number of concurrent executions to reserve for the API Handler. Setting this will prevent the API Handler from throttling other lambdas in your account. Note this will take away from your global concurrency limit in your AWS account. | `number` | `-1` | no |
| <a name="input_brainstore_backfill_disable_historical"></a> [brainstore\_backfill\_disable\_historical](#input\_brainstore\_backfill\_disable\_historical) | Disable historical backfill for Brainstore. Don't modify this unless instructed by Braintrust. | `bool` | `false` | no |
| <a name="input_brainstore_backfill_disable_nonhistorical"></a> [brainstore\_backfill\_disable\_nonhistorical](#input\_brainstore\_backfill\_disable\_nonhistorical) | Disable non-historical backfill for Brainstore. Don't modify this unless instructed by Braintrust. | `bool` | `false` | no |
| <a name="input_brainstore_backfill_new_objects"></a> [brainstore\_backfill\_new\_objects](#input\_brainstore\_backfill\_new\_objects) | Enable backfill for new objects for Brainstore. Don't modify this unless instructed by Braintrust. | `bool` | `true` | no |
| <a name="input_brainstore_default"></a> [brainstore\_default](#input\_brainstore\_default) | Whether to set Brainstore as the default rather than requiring users to opt-in via feature flag. Don't set this if you have a large backfill ongoing and are migrating from Clickhouse. | `string` | `"true"` | no |
| <a name="input_brainstore_disable_optimization_worker"></a> [brainstore\_disable\_optimization\_worker](#input\_brainstore\_disable\_optimization\_worker) | Disable the optimization worker in Brainstore | `bool` | `false` | no |
| <a name="input_brainstore_enable_historical_full_backfill"></a> [brainstore\_enable\_historical\_full\_backfill](#input\_brainstore\_enable\_historical\_full\_backfill) | Enable historical full backfill for Brainstore. Don't modify this unless instructed by Braintrust. | `bool` | `true` | no |
| <a name="input_brainstore_enable_index_validation"></a> [brainstore\_enable\_index\_validation](#input\_brainstore\_enable\_index\_validation) | Enable index validation for Brainstore | `bool` | `false` | no |
| <a name="input_brainstore_etl_batch_size"></a> [brainstore\_etl\_batch\_size](#input\_brainstore\_etl\_batch\_size) | The batch size for the ETL process | `number` | `null` | no |
| <a name="input_brainstore_extra_env_vars"></a> [brainstore\_extra\_env\_vars](#input\_brainstore\_extra\_env\_vars) | Extra environment variables to set for Brainstore | `map(string)` | `{}` | no |
| <a name="input_brainstore_index_validation_only_deletes"></a> [brainstore\_index\_validation\_only\_deletes](#input\_brainstore\_index\_validation\_only\_deletes) | Scope index validation to only deletes in Brainstore. Only applies if brainstore\_enable\_index\_validation is true | `bool` | `true` | no |
| <a name="input_brainstore_instance_count"></a> [brainstore\_instance\_count](#input\_brainstore\_instance\_count) | The number of Brainstore reader instances to provision | `number` | `2` | no |
| <a name="input_brainstore_instance_key_pair_name"></a> [brainstore\_instance\_key\_pair\_name](#input\_brainstore\_instance\_key\_pair\_name) | The name of the key pair to use for the Brainstore instance | `string` | `null` | no |
| <a name="input_brainstore_instance_type"></a> [brainstore\_instance\_type](#input\_brainstore\_instance\_type) | The instance type to use for Brainstore reader nodes. Recommended Graviton instance type with 16GB of memory and a local SSD for cache data. | `string` | `"c8gd.4xlarge"` | no |
| <a name="input_brainstore_license_key"></a> [brainstore\_license\_key](#input\_brainstore\_license\_key) | The license key for the Brainstore instance | `string` | `null` | no |
| <a name="input_brainstore_port"></a> [brainstore\_port](#input\_brainstore\_port) | The port to use for the Brainstore instance | `number` | `4000` | no |
| <a name="input_brainstore_s3_bucket_retention_days"></a> [brainstore\_s3\_bucket\_retention\_days](#input\_brainstore\_s3\_bucket\_retention\_days) | The number of days to retain non-current S3 objects. e.g. deleted objects | `number` | `7` | no |
| <a name="input_brainstore_vacuum_all_objects"></a> [brainstore\_vacuum\_all\_objects](#input\_brainstore\_vacuum\_all\_objects) | Enable vacuuming of all objects in Brainstore | `bool` | `false` | no |
| <a name="input_brainstore_version_override"></a> [brainstore\_version\_override](#input\_brainstore\_version\_override) | Lock Brainstore on a specific version. Don't set this unless instructed by Braintrust. | `string` | `null` | no |
| <a name="input_brainstore_writer_instance_count"></a> [brainstore\_writer\_instance\_count](#input\_brainstore\_writer\_instance\_count) | The number of dedicated writer nodes to create | `number` | `1` | no |
| <a name="input_brainstore_writer_instance_type"></a> [brainstore\_writer\_instance\_type](#input\_brainstore\_writer\_instance\_type) | The instance type to use for the Brainstore writer nodes | `string` | `"c8gd.8xlarge"` | no |
| <a name="input_braintrust_org_name"></a> [braintrust\_org\_name](#input\_braintrust\_org\_name) | The name of your organization in Braintrust (e.g. acme.com) | `string` | n/a | yes |
| <a name="input_clickhouse_instance_type"></a> [clickhouse\_instance\_type](#input\_clickhouse\_instance\_type) | The instance type to use for the Clickhouse instance | `string` | `"c5.2xlarge"` | no |
| <a name="input_clickhouse_metadata_storage_size"></a> [clickhouse\_metadata\_storage\_size](#input\_clickhouse\_metadata\_storage\_size) | The size of the EBS volume to use for Clickhouse metadata | `number` | `100` | no |
| <a name="input_custom_certificate_arn"></a> [custom\_certificate\_arn](#input\_custom\_certificate\_arn) | ARN of the ACM certificate for the custom domain | `string` | `null` | no |
| <a name="input_custom_domain"></a> [custom\_domain](#input\_custom\_domain) | Custom domain name for the CloudFront distribution | `string` | `null` | no |
| <a name="input_deployment_name"></a> [deployment\_name](#input\_deployment\_name) | Name of this Braintrust deployment. Will be included in tags and prefixes in resources names. Lowercase letter, numbers, and hyphens only. If you want multiple deployments in your same AWS account, use a unique name for each deployment. | `string` | `"braintrust"` | no |
| <a name="input_enable_brainstore"></a> [enable\_brainstore](#input\_enable\_brainstore) | Enable Brainstore for faster analytics | `bool` | `true` | no |
| <a name="input_enable_braintrust_support_logs_access"></a> [enable\_braintrust\_support\_logs\_access](#input\_enable\_braintrust\_support\_logs\_access) | Enable Cloudwatch logs access for Braintrust staff | `bool` | `false` | no |
| <a name="input_enable_braintrust_support_shell_access"></a> [enable\_braintrust\_support\_shell\_access](#input\_enable\_braintrust\_support\_shell\_access) | Enable Bastion shell access for Braintrust staff. This will create a bastion host and a security group that allows EC2 instance connect access from the Braintrust IAM Role. | `bool` | `false` | no |
| <a name="input_enable_clickhouse"></a> [enable\_clickhouse](#input\_enable\_clickhouse) | Enable Clickhouse for faster analytics | `bool` | `false` | no |
| <a name="input_enable_quarantine_vpc"></a> [enable\_quarantine\_vpc](#input\_enable\_quarantine\_vpc) | Enable the Quarantine VPC to run user defined functions in an isolated environment. If disabled, user defined functions will not be available. | `bool` | `true` | no |
| <a name="input_kms_key_arn"></a> [kms\_key\_arn](#input\_kms\_key\_arn) | Existing KMS key ARN to use for encrypting resources. If not provided, a new key will be created. DO NOT change this after deployment. If you do, it will attempt to destroy your DB and prior S3 objects will no longer be readable. | `string` | `""` | no |
| <a name="input_lambda_version_tag_override"></a> [lambda\_version\_tag\_override](#input\_lambda\_version\_tag\_override) | Optional override for the lambda version tag. Don't set this unless instructed by Braintrust. | `string` | `null` | no |
| <a name="input_outbound_rate_limit_max_requests"></a> [outbound\_rate\_limit\_max\_requests](#input\_outbound\_rate\_limit\_max\_requests) | The maximum number of requests per user allowed in the time frame specified by OutboundRateLimitMaxRequests. Setting to 0 will disable rate limits | `number` | `0` | no |
| <a name="input_outbound_rate_limit_window_minutes"></a> [outbound\_rate\_limit\_window\_minutes](#input\_outbound\_rate\_limit\_window\_minutes) | The time frame in minutes over which rate per-user rate limits are accumulated | `number` | `1` | no |
| <a name="input_postgres_auto_minor_version_upgrade"></a> [postgres\_auto\_minor\_version\_upgrade](#input\_postgres\_auto\_minor\_version\_upgrade) | Indicates that minor engine upgrades will be applied automatically to the DB instance during the maintenance window. When true you will have to set your postgres\_version to only the major number or you will see drift. e.g. '15' instead of '15.7' | `bool` | `true` | no |
| <a name="input_postgres_instance_type"></a> [postgres\_instance\_type](#input\_postgres\_instance\_type) | Instance type for the RDS instance. | `string` | `"db.r8g.2xlarge"` | no |
| <a name="input_postgres_max_storage_size"></a> [postgres\_max\_storage\_size](#input\_postgres\_max\_storage\_size) | Maximum storage size (in GB) to allow the RDS instance to auto-scale to. | `number` | `4000` | no |
| <a name="input_postgres_multi_az"></a> [postgres\_multi\_az](#input\_postgres\_multi\_az) | Specifies if the RDS instance is multi-AZ. Increases cost but provides higher availability. Recommended for production environments. | `bool` | `false` | no |
| <a name="input_postgres_storage_iops"></a> [postgres\_storage\_iops](#input\_postgres\_storage\_iops) | Storage IOPS for the RDS instance. Only applicable if storage\_type is io1, io2, or gp3. | `number` | `10000` | no |
| <a name="input_postgres_storage_size"></a> [postgres\_storage\_size](#input\_postgres\_storage\_size) | Storage size (in GB) for the RDS instance. | `number` | `1000` | no |
| <a name="input_postgres_storage_throughput"></a> [postgres\_storage\_throughput](#input\_postgres\_storage\_throughput) | Throughput for the RDS instance. Only applicable if storage\_type is gp3. | `number` | `500` | no |
| <a name="input_postgres_storage_type"></a> [postgres\_storage\_type](#input\_postgres\_storage\_type) | Storage type for the RDS instance. | `string` | `"gp3"` | no |
| <a name="input_postgres_version"></a> [postgres\_version](#input\_postgres\_version) | PostgreSQL engine version for the RDS instance. | `string` | `"15"` | no |
| <a name="input_private_subnet_1_az"></a> [private\_subnet\_1\_az](#input\_private\_subnet\_1\_az) | Availability zone for the first private subnet. Leave blank to choose the first available zone | `string` | `null` | no |
| <a name="input_private_subnet_2_az"></a> [private\_subnet\_2\_az](#input\_private\_subnet\_2\_az) | Availability zone for the first private subnet. Leave blank to choose the second available zone | `string` | `null` | no |
| <a name="input_private_subnet_3_az"></a> [private\_subnet\_3\_az](#input\_private\_subnet\_3\_az) | Availability zone for the third private subnet. Leave blank to choose the third available zone | `string` | `null` | no |
| <a name="input_public_subnet_1_az"></a> [public\_subnet\_1\_az](#input\_public\_subnet\_1\_az) | Availability zone for the public subnet. Leave blank to choose the first available zone | `string` | `null` | no |
| <a name="input_quarantine_private_subnet_1_az"></a> [quarantine\_private\_subnet\_1\_az](#input\_quarantine\_private\_subnet\_1\_az) | Availability zone for the first private subnet. Leave blank to choose the first available zone | `string` | `null` | no |
| <a name="input_quarantine_private_subnet_2_az"></a> [quarantine\_private\_subnet\_2\_az](#input\_quarantine\_private\_subnet\_2\_az) | Availability zone for the first private subnet. Leave blank to choose the second available zone | `string` | `null` | no |
| <a name="input_quarantine_private_subnet_3_az"></a> [quarantine\_private\_subnet\_3\_az](#input\_quarantine\_private\_subnet\_3\_az) | Availability zone for the third private subnet. Leave blank to choose the third available zone | `string` | `null` | no |
| <a name="input_quarantine_public_subnet_1_az"></a> [quarantine\_public\_subnet\_1\_az](#input\_quarantine\_public\_subnet\_1\_az) | Availability zone for the public subnet. Leave blank to choose the first available zone | `string` | `null` | no |
| <a name="input_quarantine_vpc_cidr"></a> [quarantine\_vpc\_cidr](#input\_quarantine\_vpc\_cidr) | CIDR block for the Quarantined VPC | `string` | `"10.175.8.0/21"` | no |
| <a name="input_redis_instance_type"></a> [redis\_instance\_type](#input\_redis\_instance\_type) | Instance type for the Redis cluster | `string` | `"cache.t4g.medium"` | no |
| <a name="input_redis_version"></a> [redis\_version](#input\_redis\_version) | Redis engine version | `string` | `"7.0"` | no |
| <a name="input_service_additional_policy_arns"></a> [service\_additional\_policy\_arns](#input\_service\_additional\_policy\_arns) | Additional policy ARNs to attach to the lambda functions that are the main braintrust service | `list(string)` | `[]` | no |
| <a name="input_service_extra_env_vars"></a> [service\_extra\_env\_vars](#input\_service\_extra\_env\_vars) | Extra environment variables to set for services | <pre>object({<br/>    APIHandler               = map(string)<br/>    AIProxy                  = map(string)<br/>    CatchupETL               = map(string)<br/>    MigrateDatabaseFunction  = map(string)<br/>    QuarantineWarmupFunction = map(string)<br/>  })</pre> | <pre>{<br/>  "AIProxy": {},<br/>  "APIHandler": {},<br/>  "CatchupETL": {},<br/>  "MigrateDatabaseFunction": {},<br/>  "QuarantineWarmupFunction": {}<br/>}</pre> | no |
| <a name="input_use_external_clickhouse_address"></a> [use\_external\_clickhouse\_address](#input\_use\_external\_clickhouse\_address) | Do not change this unless instructed by Braintrust. If set, the domain name or IP of the external Clickhouse instance will be used and no internal instance will be created. | `string` | `null` | no |
| <a name="input_vpc_cidr"></a> [vpc\_cidr](#input\_vpc\_cidr) | CIDR block for the VPC | `string` | `"10.175.0.0/21"` | no |
| <a name="input_whitelisted_origins"></a> [whitelisted\_origins](#input\_whitelisted\_origins) | List of origins to whitelist for CORS | `list(string)` | `[]` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_api_url"></a> [api\_url](#output\_api\_url) | The primary endpoint for the dataplane API. This is the value that should be entered into the braintrust dashboard under API URL. |
| <a name="output_bastion_instance_id"></a> [bastion\_instance\_id](#output\_bastion\_instance\_id) | Instance ID of the bastion host that Braintrust support staff can connect to using EC2 Instance Connect. Share this with the Braintrust team. |
| <a name="output_braintrust_support_role_arn"></a> [braintrust\_support\_role\_arn](#output\_braintrust\_support\_role\_arn) | ARN of the Role that grants Braintrust team remote support. Share this with the Braintrust team. |
| <a name="output_clickhouse_host"></a> [clickhouse\_host](#output\_clickhouse\_host) | Host of the Clickhouse instance |
| <a name="output_clickhouse_s3_bucket_name"></a> [clickhouse\_s3\_bucket\_name](#output\_clickhouse\_s3\_bucket\_name) | Name of the Clickhouse S3 bucket |
| <a name="output_clickhouse_secret_id"></a> [clickhouse\_secret\_id](#output\_clickhouse\_secret\_id) | ID of the Clickhouse secret. Note this is the Terraform ID attribute which is a pipe delimited combination of secret ID and version ID |
| <a name="output_main_vpc_cidr"></a> [main\_vpc\_cidr](#output\_main\_vpc\_cidr) | CIDR block of the main VPC |
| <a name="output_main_vpc_default_security_group_id"></a> [main\_vpc\_default\_security\_group\_id](#output\_main\_vpc\_default\_security\_group\_id) | ID of the default security group in the main VPC |
| <a name="output_main_vpc_id"></a> [main\_vpc\_id](#output\_main\_vpc\_id) | ID of the main VPC that contains the Braintrust resources |
| <a name="output_main_vpc_private_route_table_id"></a> [main\_vpc\_private\_route\_table\_id](#output\_main\_vpc\_private\_route\_table\_id) | ID of the private route table in the main VPC |
| <a name="output_main_vpc_private_subnet_1_id"></a> [main\_vpc\_private\_subnet\_1\_id](#output\_main\_vpc\_private\_subnet\_1\_id) | ID of the first private subnet in the main VPC |
| <a name="output_main_vpc_private_subnet_2_id"></a> [main\_vpc\_private\_subnet\_2\_id](#output\_main\_vpc\_private\_subnet\_2\_id) | ID of the second private subnet in the main VPC |
| <a name="output_main_vpc_private_subnet_3_id"></a> [main\_vpc\_private\_subnet\_3\_id](#output\_main\_vpc\_private\_subnet\_3\_id) | ID of the third private subnet in the main VPC |
| <a name="output_main_vpc_public_route_table_id"></a> [main\_vpc\_public\_route\_table\_id](#output\_main\_vpc\_public\_route\_table\_id) | ID of the public route table in the main VPC |
| <a name="output_main_vpc_public_subnet_1_id"></a> [main\_vpc\_public\_subnet\_1\_id](#output\_main\_vpc\_public\_subnet\_1\_id) | ID of the public subnet in the main VPC |
| <a name="output_postgres_database_arn"></a> [postgres\_database\_arn](#output\_postgres\_database\_arn) | ARN of the main Braintrust Postgres database |
| <a name="output_quarantine_vpc_id"></a> [quarantine\_vpc\_id](#output\_quarantine\_vpc\_id) | ID of the quarantine VPC that user functions run inside of. |
| <a name="output_redis_arn"></a> [redis\_arn](#output\_redis\_arn) | ARN of the Redis instance |
